<!-- src/main/resources/templates/project/form.html -->
<!DOCTYPE html>
<html lang="ru"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title layout:fragment="title"
         th:text="${title} ?: 'Форма проекта'">Форма проекта</title>
  <!-- Если Bootstrap не подключён в ваш layout.html, раскомментируйте следующую строку: -->
  <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/> -->
</head>
<body>
<!-- Всё внутри этого div попадёт в <main layout:fragment="content"> вашего layout.html -->
<div layout:fragment="content" class="container py-4">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <h3 class="mb-0" th:text="${title}">Форма проекта</h3>
        </div>
        <div class="card-body">
          <form th:action="@{/projects}"
                th:object="${project}"
                method="post"
                class="needs-validation"
                novalidate>
            <!-- CSRF-токен (Spring Security) -->
            <input type="hidden"
                   th:name="${_csrf.parameterName}"
                   th:value="${_csrf.token}"/>

            <!-- Если проект уже существует (p.id != null), прячем его id -->
            <input type="hidden"
                   th:if="${project.id != null}"
                   th:field="*{id}"/>

            <!-- Название -->
            <div class="mb-3">
              <label for="name" class="form-label">Название</label>
              <input type="text"
                     id="name"
                     th:field="*{name}"
                     class="form-control"
                     placeholder="Введите название проекта"
                     required/>
              <div class="invalid-feedback">
                Пожалуйста, введите название проекта.
              </div>
              <div class="text-danger mt-1"
                   th:if="${#fields.hasErrors('name')}"
                   th:errors="*{name}"></div>
            </div>

            <!-- Описание (необязательно) -->
            <div class="mb-3">
              <label for="description" class="form-label">Описание</label>
              <textarea id="description"
                        th:field="*{description}"
                        class="form-control"
                        rows="4"
                        placeholder="Введите описание проекта"></textarea>
            </div>

            <!-- Радиокнопки: Личный vs Командный проект -->
            <div class="mb-4">
              <label class="form-label d-block">Тип проекта</label>

              <!-- 1) Личный проект: всегда можно выбрать -->
              <div class="form-check form-check-inline">
                <input class="form-check-input"
                       type="radio"
                       name="projectType"
                       id="privateRadio"
                       value="PRIVATE"
                       th:checked="${project.team == null}"/>
                <label class="form-check-label" for="privateRadio">
                  Личный проект
                </label>
              </div>

              <!-- 2) Командный проект: показываем только если у пользователя есть команда (hasTeam == true) -->
              <div class="form-check form-check-inline" th:if="${hasTeam}">
                <input class="form-check-input"
                       type="radio"
                       name="projectType"
                       id="teamRadio"
                       value="TEAM"
                       th:checked="${project.team != null}"/>
                <label class="form-check-label" for="teamRadio">
                  Командный проект
                </label>
              </div>
            </div>

            <!-- Кнопки: Сохранить / Отмена -->
            <div class="d-flex">
              <button type="submit" class="btn btn-primary me-2">
                <span th:text="${project.id == null} ? 'Сохранить' : 'Обновить'">Сохранить</span>
              </button>
              <a th:href="@{/projects}" class="btn btn-outline-secondary">Отмена</a>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div> <!-- /content -->

<!-- Скрипт Bootstrap-валидации -->
<script>
  (function () {
    'use strict';
    const forms = document.querySelectorAll('.needs-validation');
    Array.from(forms).forEach(function (form) {
      form.addEventListener('submit', function (event) {
        if (!form.checkValidity()) {
          event.preventDefault();
          event.stopPropagation();
        }
        form.classList.add('was-validated');
      }, false);
    });
  })();
</script>

<!-- Если Bootstrap.js не подключён в layout.html, можно раскомментировать: -->
<!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script> -->
</body>
</html>
