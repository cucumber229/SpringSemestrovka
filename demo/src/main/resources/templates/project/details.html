<!-- src/main/resources/templates/project/details.html -->
<!DOCTYPE html>
<html lang="ru"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <!-- Передаём фрагмент title в layout -->
  <title layout:fragment="title" th:text="${title}">Детали проекта</title>
</head>
<body>
<!-- Попадёт в <main layout:fragment="content"> вашего layout.html -->
<div layout:fragment="content">
  <div class="container py-4">
    <div class="row justify-content-center">
      <div class="col-md-8">
        <div class="card mt-5 shadow-sm">
          <div class="card-header bg-primary text-white">
            <h3 class="mb-0" th:text="${project.name}">Название проекта</h3>
          </div>
          <div class="card-body">

            <!-- Блок с описанием -->
            <p class="mb-4" th:text="${project.description}">Описание проекта</p>

            <!-- Информация о владельце и дате создания -->
            <div class="mb-3">
              <span class="fw-bold">Владелец:</span>
              <span th:text="${project.owner.username}">owner_username</span>
            </div>
            <div class="mb-3">
              <span class="fw-bold">Команда:</span>
              <span th:if="${project.team != null}"
                    th:text="${project.team.name}">Имя команды</span>
              <span th:if="${project.team == null}">— личный проект —</span>
            </div>
            <div class="mb-3">
              <span class="fw-bold">Создан:</span>
              <span th:text="${#temporals.format(project.createdAt, 'yyyy-MM-dd HH:mm')}">
                  дата и время
                </span>
            </div>

            <!-- Кнопки действий -->
            <div class="d-flex mt-4">
              <!--
                  «Редактировать»: видно только если текущий
                  пользователь — владелец ИЛИ у него есть ROLE_ADMIN
              -->
              <a th:if="${#authentication.name == project.owner.username or hasRole('ROLE_ADMIN')}"
                 th:href="@{|/projects/${project.id}/edit|}"
                 class="btn btn-outline-primary me-2">
                <i class="bi bi-pencil me-1"></i> Редактировать
              </a>

              <!--
                  «Удалить»: форма с POST, тоже только владельцу или ADMIN
                  По возможности сохраняем CSRF-токен
              -->
              <form th:if="${#authentication.name == project.owner.username or hasRole('ROLE_ADMIN')}"
                    th:action="@{|/projects/${project.id}/delete|}"
                    method="post"
                    style="display:inline">
                <input type="hidden"
                       th:name="${_csrf.parameterName}"
                       th:value="${_csrf.token}"/>
                <button type="submit" class="btn btn-outline-danger me-2">
                  <i class="bi bi-trash me-1"></i> Удалить
                </button>
              </form>

              <!-- Всегда показываем «Назад к списку» -->
              <a th:href="@{/projects}" class="btn btn-link ms-auto align-self-center">
                ← Назад к списку
              </a>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</body>
</html>
