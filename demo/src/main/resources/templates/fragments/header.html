<!-- templates/fragments/header.html -->
<th:block th:fragment="header">

  <nav
     xmlns:th="http://www.thymeleaf.org"
     xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity6"
     class="navbar">
  <div class="container">
    <!-- ======== ЛОГОТИП ======== -->
    <a class="navbar-brand" th:href="@{/}">TeamManager</a>

    <!-- ======== Основная навигация (большие экраны) ======== -->
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" th:href="@{/projects}"
           th:classappend="${activePage} == 'projects' ? ' active'">
          Проекты
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" th:href="@{/tasks}"
           th:classappend="${activePage} == 'tasks' ? ' active'">
          Задачи
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" th:href="@{/teams}"
           th:classappend="${activePage} == 'teams' ? ' active'">
          Команды
        </a>
      </li>
    </ul>

    <!-- ======== Блок авторизации (большие экраны) ======== -->
    <div class="auth-nav">
      <!-- Если гость -->
      <ul class="navbar-nav" sec:authorize="isAnonymous()">
        <li class="nav-item">
          <a class="nav-link" th:href="@{/login}"
             th:classappend="${activePage} == 'login' ? ' active'">
            Войти
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" th:href="@{/register}"
             th:classappend="${activePage} == 'register' ? ' active'">
            Регистрация
          </a>
        </li>
      </ul>

      <!-- Если аутентифицирован -->
      <ul class="navbar-nav" sec:authorize="isAuthenticated()">
        <li class="nav-item navbar-text">
          Привет, <strong sec:authentication="name"></strong>
        </li>
        <li class="nav-item">
          <a class="nav-link" th:href="@{/profile}"
             th:classappend="${activePage} == 'profile' ? ' active'">
            Профиль
          </a>
        </li>
        <li class="nav-item">
          <form th:action="@{/logout}" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}"
                   th:value="${_csrf.token}"/>
            <button type="submit" class="btn btn-link nav-link">Выйти</button>
          </form>
        </li>
      </ul>
    </div>

    <!-- ======== Кнопка-гамбургер для мобильных ======== -->
    <button class="navbar-toggler" type="button" aria-controls="navbarMenu"
            aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"><div></div></span>
    </button>
  </div>

  <!-- ======== Мобильное меню ======== -->
  <div class="navbar-collapse" id="navbarMenu">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" th:href="@{/projects}"
           th:classappend="${activePage} == 'projects' ? ' active'">
          Проекты
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" th:href="@{/tasks}"
           th:classappend="${activePage} == 'tasks' ? ' active'">
          Задачи
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" th:href="@{/teams}"
           th:classappend="${activePage} == 'teams' ? ' active'">
          Команды
        </a>
      </li>

      <!-- Мобильное авторизационное меню -->
      <li class="nav-item" sec:authorize="isAnonymous()">
        <a class="nav-link" th:href="@{/login}"
           th:classappend="${activePage} == 'login' ? ' active'">
          Войти
        </a>
      </li>
      <li class="nav-item" sec:authorize="isAnonymous()">
        <a class="nav-link" th:href="@{/register}"
           th:classappend="${activePage} == 'register' ? ' active'">
          Регистрация
        </a>
      </li>
      <li class="nav-item" sec:authorize="isAuthenticated()">
        <a class="nav-link" th:href="@{/profile}"
           th:classappend="${activePage} == 'profile' ? ' active'">
          Профиль
        </a>
      </li>
      <li class="nav-item" sec:authorize="isAuthenticated()">
        <form th:action="@{/logout}" method="post">
          <input type="hidden" th:name="${_csrf.parameterName}"
                 th:value="${_csrf.token}"/>
          <button type="submit" class="btn btn-link nav-link">
            Выйти
          </button>
        </form>
      </li>
    </ul>
  </div>
  </nav>
</th:block>
